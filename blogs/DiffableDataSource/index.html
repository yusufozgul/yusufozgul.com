<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Yusuf Özgül | Blog | Resume | Portfolio"/><link rel="canonical" href="https://yusufozgul.com/blogs/DiffableDataSource"/><meta name="twitter:url" content="https://yusufozgul.com/blogs/DiffableDataSource"/><meta name="og:url" content="https://yusufozgul.com/blogs/DiffableDataSource"/><title>Diffable Data Source | Yusuf Özgül | Blog | Resume | Portfolio</title><meta name="twitter:title" content="Diffable Data Source | Yusuf Özgül | Blog | Resume | Portfolio"/><meta name="og:title" content="Diffable Data Source | Yusuf Özgül | Blog | Resume | Portfolio"/><meta name="description" content="Daha güvenilir, daha kullanışlı ve daha performanslı data source:  UICollectionViewDiffableDataSource"/><meta name="twitter:description" content="Daha güvenilir, daha kullanışlı ve daha performanslı data source:  UICollectionViewDiffableDataSource"/><meta name="og:description" content="Daha güvenilir, daha kullanışlı ve daha performanslı data source:  UICollectionViewDiffableDataSource"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/gallery.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/upload-images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Yusuf Özgül | Blog | Resume | Portfolio"/><meta name="twitter:image" content="https://yusufozgul.com/upload-images/"/><meta name="og:image" content="https://yusufozgul.com/upload-images/"/></head><body class="main-wrapper"><header><link rel="stylesheet" href="/navigationStyle.css" type="text/css"/><nav class="header navBar"><div class="navArea"><input type="checkbox" id="check"/><label for="check"><img src="/upload-images/base/menu-icon.svg" width="30" height="30" class="checkbtn"/></label><label class="logo"><a href="/">Yusuf Özgül</a></label><ul class="navContent" id="hoverEnabled"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li><li><a href="/projects">Projects</a></li><li><a href="/blogs" class="active">Blog</a></li></ul></div></nav></header><div class="wrapper"><h2 class="post-title">Diffable Data Source</h2><a><p>January 4, 2021<br/>Reading 11 minutes</p></a><ul class="tag-list"><li class="swift"><a href="/tags/swift">Swift</a></li><li class="collectionView"><a href="/tags/collectionview">CollectionView</a></li></ul><div class="post-description"><div><p>Bir önceki yazımda Collection View'da daha rahat daha esnek ve daha performanslı layout tasarlamayı anlatmıştım. Eğer okumadıysanız:</p><p><a href="https://yusufozgul.com/blogs/CompositionalLayout/">Compositional Layout)</a></p><p>Bu yazımda ise Collection View'un bir diğer yönü olan data kısmındaki yeni Diffable Data Source'u anlatacağım.</p><h3>Bu zamana kadar nasıldı?</h3><p>Collection View ya da Table View'u oluştururken ona data source veriyorduk, bu temelde bir protokol'ü implemente eden herhangi bir class. Bu içerisinde kaç cell olacağını, hangi index / section için nasıl bir view ve verisi olacağını belirlemeyi sağlıyordu. Bu açıdan oldukça kolay ve her türlü view'u kullanmak oldukça kolay. Ancak bazı kusurları var, öncelikle bu yapıda datanın güvenliğini sağlamak bizim görevimiz. Ona dersek ki sana 10 tane data ekledim, ancak elimizdeki modeli güncelleme sırasında bir sorun oluşursa crash, bir sebepten ötürü reload sırasında data silinir ya da başka bir şey olursa olmayan bir index'e erişmeye çalışıp crash edebilir. Peki diffable data source?</p><h3>Diffable Data Source</h3><blockquote><p>Bunu collection view üzerinden anlatacağım ama table view için isim değişikliği haricinde aynı şekilde kullanılabilir.</p></blockquote><p>Bize lazım olan iki şey var, birincisi bir data source ikincisi aynı yapıda bir snapshot.</p><ol><li>Data Source:</li></ol><pre><code><span class="type">UICollectionViewDiffableDataSource</span>&lt;<span class="type">Section</span>, <span class="type">Data</span>&gt;

<span class="comment">// Section: Hashable
// Data: Hashable</span> 
</code></pre><p>tipinde bir değişiklik, burada dikkat edilmesi gereken konu datanın aynı zamanda identifiable olduğunu sağlamak gerekiyor, buna göre data ayrıt edilip değişiklikler buna göre alınıyor.</p><pre><code>dataSource = .<span class="keyword">init</span>(collectionView: productListCollectionView, cellProvider: { (collectionView, indexPath, data) -&gt; <span class="type">UICollectionViewCell</span>? <span class="keyword">in
    let</span> cell = collectionView.<span class="call">dequeueReusableCell</span>(withReuseIdentifier: <span class="string">"reuseIdentifier"</span>, for: indexPath) <span class="keyword">as</span>? <span class="type">BannerCell</span>
    cell?.<span class="property">image</span>.<span class="call">loadImage</span>(from: data.<span class="property">imageURL</span>)
    <span class="keyword">return</span> cell
})
</code></pre><p>Data source'u init ederken ona bizim collection view'umuzu verdik. Data source yaşadığı sürece bunu tutacak ve güncellemeleri yapacak. O ise bize collection view, indexPath, data bilgilerini veriyor. Burada asıl önemli detay bize datanın gelmesi, çünkü oraya gelen data kesin ve doğru olduğuna eminiz. Klasik şekilde cell'imizi oluşturduk ve datayı kullanarak içerisine gönderdik. Geriye kaldı tek bir şey.</p><ol start="2"><li>Update:</li></ol><p>Nispeten daha kolay bir olay yapmamız gereken bir snap shot oluşturmak ve data source'a göndermek.</p><pre><code><span class="type">NSDiffableDataSourceSnapshot</span>&lt;<span class="type">Section</span>, <span class="type">Data</span>&gt;

<span class="comment">// Section: Hashable
// Data: Hashable</span> 
</code></pre><pre><code><span class="keyword">func</span> updateView(sections: [<span class="type">Section</span>]) {
    <span class="keyword">var</span> snapShot = <span class="type">WidgetsSnapshot</span>() <span class="comment">// Snapshot oluştur</span>
    snapShot.<span class="call">appendSections</span>(sections) <span class="comment">// Kullanılacak tüm section'ları ekle</span>

    <span class="keyword">for</span> section <span class="keyword">in</span> sections {
        snapShot.<span class="call">appendItems</span>(section.<span class="property">items</span>, toSection: section) <span class="comment">// her section'a verisini ekle</span>
    }

    dataSource.<span class="call">apply</span>(snapShot) <span class="comment">// apply ederek güncellenmesini sağla ( animasyon seçeneği gönderilebilir, varsayılan true )</span>
}
</code></pre><h2>Sonuç</h2><p>Basit anlatımıyla bu şekilde olan diffable data source bize güzel şeyler sunuyor, değişenleri otomatik alıp bunu animasyonlu yapması, arkaplanda çok hızlı yapması, çökmelere karşı güvenilir olması gibi gibi. Eklemek isteiğim son bir iki şey ise bunun minimum iOS 13'te kullanılabiliyor olması dezavantaj olabilir, bir diğeri ise section ve data tanımlamalarında enum kullanabilirsiniz, özellikle section için enum kullanmak işleri kolaylaştırır.</p><h3>Daha fazlası:</h3><p><a href="https://github.com/yusufozgul/DeezerSampleApp">yusufozgul/DeezerSampleApp</a></p></div></div></div><footer><p><a href="https://github.com/johnsundell/publish">Generated using Publish</a></p><p><a href="/feed.rss">RSS feed</a></p><p><a href="https://github.com/yusufozgul">Developed Yusuf Özgül</a></p></footer></body></html>